#include "Utils.h"
//#include <iostream>
#include <windows.h>
//#include <winspool.h>
//#include <string>
//#include <cstring>
//#include <vector>
/*#include <string.h> */    // for strcpy_s, strcat_s
/*#include <stdlib.h>*/     // for _countof
/*#include <stdio.h>*/      // for printf
//#define _CRT_SECURE_NO_WARNINGS
//#include <errno.h>


std::string Utils::EnteringInformation() 
{
    std::string age;

    std::cout << "Entrez votre age : ";
    std::cin >> age;

    return age;
}


void Utils::DisplayInformation(std::string age)
{
    std::cout << "Age de l'utilisateur : " << age << std::endl;
}


void Utils::Printing(std::string age)
{
    DWORD dwSize = 0;
    GetDefaultPrinter(NULL, &dwSize);

    // Allouer de la mémoire pour le nom de l'imprimante par défaut.
    wchar_t* pDefaultPrinterName = new wchar_t[dwSize];

    // -1-
    if (GetDefaultPrinter(pDefaultPrinterName, &dwSize)) {
        std::wcout << L"Imprimante par defaut : " << pDefaultPrinterName << std::endl;
    } 
    
    HANDLE handlePrinter = NULL;
    LPHANDLE lphandlePrinter = &handlePrinter;

    PRINTER_DEFAULTS printerDefaults;
    printerDefaults.pDatatype = NULL;
    printerDefaults.pDevMode = NULL;
    printerDefaults.DesiredAccess = PRINTER_ACCESS_USE;

    // -2-
    OpenPrinter(pDefaultPrinterName, lphandlePrinter, NULL);

    DWORD level = 1;

    const int length = age.length();
    char* data = new char[length + 1];
    strcpy_s(data, length+1, age.c_str());

    DWORD dataSize = sizeof(data);
    dataSize = dataSize - 1;

    DOC_INFO_1 docInfo;

    const wchar_t* docName = L"Age_Utilisateur";
    LPTSTR lpDocName = const_cast<LPTSTR>(docName);

    const wchar_t* dataType = L"TEXT";
    LPTSTR lpDataType = const_cast<LPTSTR>(dataType);

    docInfo.pOutputFile = NULL;
    docInfo.pDocName = lpDocName;
    docInfo.pDatatype = lpDataType;

    // -3-
    DWORD printJob = StartDocPrinter(handlePrinter, level, (LPBYTE)&docInfo);

    // -4-
    StartPagePrinter(handlePrinter);

    DWORD bytesWritten = 0;

    // -5-
    if (!WritePrinter(handlePrinter, (LPVOID)data, dataSize, &bytesWritten)) {
        std::cerr << "Echec de l'impression!" << std::endl;
        ClosePrinter(handlePrinter);
        return;
    }

    // -6-
    EndPagePrinter(handlePrinter);

    // -7-
    EndDocPrinter(handlePrinter);

    // -8- 
    ClosePrinter(handlePrinter);

    delete[] pDefaultPrinterName;
}
